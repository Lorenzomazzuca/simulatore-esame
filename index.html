<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulatore</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f2027;
  color:white;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.container{
  background:white;
  color:black;
  width:90%;
  max-width:800px;
  padding:20px;
  border-radius:12px;
}

h1{
  margin-top:0;
}

select, button{
  padding:8px 12px;
  margin:5px 0;
  border-radius:6px;
  border:none;
  cursor:pointer;
}

button{
  background:#2a5298;
  color:white;
}

.answers button{
  display:block;
  width:100%;
  margin:6px 0;
  background:#eee;
  color:black;
}

.correct{
  background:#2e7d32 !important;
  color:white !important;
}

.wrong{
  background:#c62828 !important;
  color:white !important;
}

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
</style>
</head>

<body>

<div class="container">

<div class="top">
  <h1>Simulatore</h1>

  <select id="sizeSelect">
    <option value="30">30 domande</option>
    <option value="50">50 domande</option>
    <option value="75">75 domande</option>
    <option value="100">100 domande</option>
    <option value="all" selected>Tutte</option>
  </select>
</div>

<p>Domanda <span id="current">1</span> / <span id="total">0</span></p>
<p>Punteggio: <span id="score">0</span></p>

<h3 id="question">Caricamento...</h3>

<div class="answers" id="answers"></div>

<br>

<button onclick="prev()">⬅ Indietro</button>
<button onclick="next()">Avanti ➡</button>
<button onclick="restart()">Ricomincia</button>

</div>

<script>

let quiz = [];
let order = [];
let currentPos = 0;
let selected = {};

function shuffle(array){
  for (let i = array.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function restart(){

  currentPos = 0;
  selected = {};

  const sizeSel = document.getElementById("sizeSelect").value;

  let maxSize = quiz.length;

  if(sizeSel !== "all"){
    maxSize = Math.min(parseInt(sizeSel), quiz.length);
  }

  order = shuffle([...Array(quiz.length).keys()]).slice(0, maxSize);

  render();
}

function render(){

  const total = order.length;
  document.getElementById("total").textContent = total;
  document.getElementById("current").textContent = currentPos + 1;

  const qIndex = order[currentPos];
  const q = quiz[qIndex];

  document.getElementById("question").textContent = q.question;

  const ansDiv = document.getElementById("answers");
  ansDiv.innerHTML = "";

  q.answers.forEach((ans, i) => {

    const btn = document.createElement("button");
    btn.textContent = String.fromCharCode(65 + i) + ") " + ans;

    if(selected[qIndex] !== undefined){
      if(i === q.correct) btn.classList.add("correct");
      if(selected[qIndex] === i && i !== q.correct) btn.classList.add("wrong");
    }

    btn.onclick = () => {
      selected[qIndex] = i;
      render();
      updateScore();
    };

    ansDiv.appendChild(btn);
  });

  updateScore();
}

function updateScore(){
  let score = 0;
  Object.keys(selected).forEach(k => {
    if(selected[k] === quiz[k].correct){
      score++;
    }
  });
  document.getElementById("score").textContent = score;
}

function next(){
  if(currentPos < order.length - 1){
    currentPos++;
    render();
  }
}

function prev(){
  if(currentPos > 0){
    currentPos--;
    render();
  }
}

fetch("questions.json")
  .then(res => res.json())
  .then(data => {
    quiz = data;
    restart();
  })
  .catch(() => {
    document.getElementById("question").textContent = "Errore caricamento domande.";
  });

</script>

</body>
</html>
